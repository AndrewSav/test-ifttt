# Test IFTTT application

This is a setup that uses [webhook](https://github.com/adnanh/webhook) and a test web site to demonstrate how pressing on and off button on your phone changes green smiley face into red sad face.

You will need to own a domain and be able to point this domain to the ip address of the machine you are running this setup on.

It uses:

- [IFTTT](https://ifttt.com)
- [Let's Encrypt](https://letsencrypt.org)
- [Traefik](https://traefik.io)
- [Webhook](https://github.com/adnanh/webhook)

This repo sets up the static web site and the webhook website with TLS certs generated by Traefic via Let's Encrpt.

Settings you will need to proivde:

- EMAIL="mail@domain.tld" - email that goes to Let's Encrypt for the domain registration. This is used by Let's Encrypt for certificate revocation latter if needed.
- STATIC="static.domain.tld" - your static site domain
- WEBHOOK="webhook.domain.tld" - your webhook domain

This setup depends on two custom docker images:
- [For the website](docker/microbot)
- [For the webhook](docker/webhook)

The two container need to be built and pushed to a public registry. I'm using `andrewsav\microbot` and `andrewsav\webhook` images respectivly, you will need to changes these names if you want to build your own.

Steps to get this up and running:

- Point yout domain for the static site and your domain for webhook to the ip of the docker host machine you are going to install it to. The ip needs to be publicly available so that Let's Encrypt could validate that you own the domains.
- Clone the repo
- Copy `settings.sh.template` to `settings.sh`
- Edit settings.sh providing the settings above
- Run `init.sh` to create docker-compose.yml and traefik/traefik.toml from templates and to use them to create the docker containers

Use docker logs to diagnose if something went wrong. You should be able to go to your <https://static.domain.tld> and <https://webhook.domain.tld/hooks/microbot> (port 443 both) to access these. 

Issue a get request on the following urls to turn smiley face on and of:

- ON: <https://webhook.domain.tld/hooks/microbot?action=start>
- OFF: <https://webhook.domain.tld/hooks/microbot?action=stop>

These should cause the smiley face to flip by adding/removing a static file, that the site is polling every second for.

On IFTTT create a new app:

- use button widget as the trigger
- use webhook as the reaction.
  - put https://webhook.domain.tld/hooks/microbot?action=start in you first applet and call it "Start"
  - put https://webhook.domain.tld/hooks/microbot?action=stop in you second applet and call it "Stop"
- Use widget option in the options menu of IFTTT application on your phone to place the "Start" and "Stop" widget buttons on your phone screen

Now you should be able to press the Start and Stop buttons to flip the face. 

